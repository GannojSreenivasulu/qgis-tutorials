<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Running and Scheduling QGIS Processing Jobs &mdash; QGIS Tutorials and Tips</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.2.0/united/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.2.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="QGIS Tutorials and Tips" href="../index.html" />
    <link rel="next" title="Find Neighbor Polygons in a Layer" href="find_neighbor_polygons.html" />
    <link rel="prev" title="Writing Python Scripts for Processing Framework" href="processing_python_scripts.html" />

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-690672-13', 'qgistutorials.com');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');
</script>


  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><img src="../_static/logo.png">
          QGIS Tutorials and Tips</a>
        <span class="navbar-text navbar-version pull-left"><b>v1.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Tutorials List <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introducción</a></li>
<li class="toctree-l1"><a class="reference internal" href="making_a_map.html">Creando un Mapa</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_attributes.html">Trabajo con atributos</a></li>
<li class="toctree-l1"><a class="reference internal" href="importing_spreadsheets_csv.html">Importación de hojas de cálculo o archivos CSV</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_plugins.html">Uso de complementos</a></li>
<li class="toctree-l1"><a class="reference internal" href="downloading_osm_data.html">Buscando y descargando datos de OpenStreetMap</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_vector_styling.html">Estilos vectoriales básicos</a></li>
<li class="toctree-l1"><a class="reference internal" href="calculating_line_lengths.html">Cálculo de longitudes de línea y estadísticas</a></li>
<li class="toctree-l1"><a class="reference internal" href="raster_styling_and_analysis.html">Basic Raster Styling and Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="raster_mosaicing_and_clipping.html">Raster Mosaicing and Clipping</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_terrain.html">Trabajar con datos de terreno</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_wms.html">Trabajando con datos WMS</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_projections.html">Trabajando con proyecciones</a></li>
<li class="toctree-l1"><a class="reference internal" href="georeferencing_basics.html">Georeferenciación de hojas topografícas y mapas escaneados</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_georeferencing.html">Georeferenciación de imágenes aéreas</a></li>
<li class="toctree-l1"><a class="reference internal" href="digitizing_basics.html">Digitizing Map Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="performing_table_joins.html">Realización de uniones de tabla</a></li>
<li class="toctree-l1"><a class="reference internal" href="performing_spatial_joins.html">Realización de uniones espaciales</a></li>
<li class="toctree-l1"><a class="reference internal" href="points_in_polygon.html">Análisis de puntos en polígonos</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_heatmaps.html">Creando Mapas de Calor</a></li>
<li class="toctree-l1"><a class="reference internal" href="performing_spatial_queries.html">Realización de consultas espaciales</a></li>
<li class="toctree-l1"><a class="reference internal" href="nearest_neighbor_analysis.html">Análisis de vecino más cercano</a></li>
<li class="toctree-l1"><a class="reference internal" href="sampling_raster_data.html">Sampling Raster Data using Points or Polygons</a></li>
<li class="toctree-l1"><a class="reference internal" href="interpolating_point_data.html">Interpolating Point Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="batch_processing.html">Batch Processing using Processing Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing_graphical_modeler.html">Automating Complex Workflows using Processing Modeler</a></li>
<li class="toctree-l1"><a class="reference internal" href="automating_map_creation.html">Automating Map Creation with Print Composer Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_qgis_browser.html">Usando QGIS Browser</a></li>
<li class="toctree-l1"><a class="reference internal" href="counting_vertices.html">Contando el numero de vertices en una capa</a></li>
<li class="toctree-l1"><a class="reference internal" href="open_bil_bip_bsq_files.html">Open BIL, BIP or BSQ files in QGIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started_with_pyqgis.html">Getting Started With Python Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="building_a_python_plugin.html">Construir una extension Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_python_functions.html">Using Custom Python Expression Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing_python_scripts.html">Writing Python Scripts for Processing Framework</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Running and Scheduling QGIS Processing Jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="find_neighbor_polygons.html">Find Neighbor Polygons in a Layer</a></li>
<li class="toctree-l1"><a class="reference internal" href="performing_table_joins_pyqgis.html">Realización de uniones de tabla (PyQGIS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="web_mapping_with_qgis2web.html">Mapeo web con QGIS2Web</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_basemaps_with_qtiles.html">Creating Basemaps with QTiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="learning_resources.html">Recursos de aprendizaje QGIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="credits.html">Créditos de los Conjuntos de Datos</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="processing_python_scripts.html" title="Previous Chapter: Writing Python Scripts for Processing Framework"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Writing Python S...</span>
    </a>
  </li>
  <li>
    <a href="find_neighbor_polygons.html" title="Next Chapter: Find Neighbor Polygons in a Layer"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Find Neighbor Po... &raquo;</span>
    </a>
  </li>
              
            
            

            

            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><h4>Author</h4>
<p>Ujaval Gandhi</p>
<a href="https://twitter.com/intent/follow?screen_name=spatialthoughts" class="twitter-follow-button" data-show-count="false">Follow @spatialthoughts</a>

<h4>Change Language</h4>
<form role="form" class="sidebar-form sidebar-left">
<select id="languages" class="form-control select-mini">
  <option value="en">English</option>
  <option value="zh_TW">Chinese (Taiwan)</option>
  <option value="nl">Dutch</option>
  <option value="fi_FI">Finnish</option>
  <option value="fr">French</option>
  <option value="de">German</option>
  <option value="el">Greek</option>
  <option value="id">Indonesian</option>
  <option value="it">Italian</option>
  <option value="ko">Korean</option>
  <option value="pt_BR">Portuguese</option>
  <option value="ro">Romanian</option>
  <option value="ru">Russian</option>
  <option value="sl">Slovenian</option>
  <option value="es">Spanish</option>
  <option value="th">Thai</option>
  <option value="tr">Turkish</option>
  <option value="uk">Ukrainian</option>
  <option value="vi">Vietnamese</option>
</select>
</form>



  


<h4>Share</h4>
<div class="addthis_sharing_toolbox"></div>
        </div>
      </div>
    <div class="col-md-9">
      

  <div class="section" id="running-and-scheduling-qgis-processing-jobs">
<h1>Running and Scheduling QGIS Processing Jobs<a class="headerlink" href="#running-and-scheduling-qgis-processing-jobs" title="Enlazar permanentemente con este título">¶</a></h1>
<p>You can automate a lot of tasks in QGIS using Python scripting (PyQGIS) and the
Processing Framework. Most of the time, you would run these scripts manually
while QGIS is open. While that is helpful, many times you need a way to run
this jobs via the command-line and without needing to open QGIS. Fortunately,
you can write standalone python scripts that use QGIS libraries and can be run
via the command-line. In this tutorial, we will learn how to write and
schedule a job that uses the QGIS Processing framework.</p>
<div class="section" id="overview-of-the-task">
<h2>Overview of the task<a class="headerlink" href="#overview-of-the-task" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Let&#8217;s say we are working on some analysis using shapefiles of a region. The
shapefiles are updated on a daily basis and we always need the latest file. But
before we can use these files, we need to cleanup the data. We can setup a QGIS
job that automates this process and runs it daily so you have the latest
cleaned up shapefiles for your work. We will write a standalone Python script
that downloads a shapefile and run topological cleaning operations on a daily
basis.</p>
<div class="section" id="other-skills-you-will-learn">
<h3>Otras habilidades que aprenderás<a class="headerlink" href="#other-skills-you-will-learn" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li>Downloading and unzipping files using Python.</li>
<li>Running any Processing algorithm via PyQGIS.</li>
<li>Fixing topological errors in a vector layer.</li>
</ul>
</div>
</div>
<div class="section" id="get-the-data">
<h2>Obtener los datos<a class="headerlink" href="#get-the-data" title="Enlazar permanentemente con este título">¶</a></h2>
<p><a class="reference external" href="http://www.geofabrik.de/">Geofabrik</a> provides daily updated shapefiles of
<a class="reference external" href="http://www.openstreetmap.org/">OpenStreetMap</a> datasets.</p>
<p>We will use <a class="reference external" href="http://download.geofabrik.de/australia-oceania.html">shapefiles for Fiji</a> for this exercise.
Download the <a class="reference external" href="http://download.geofabrik.de/australia-oceania/fiji-latest.shp.zip">fiji-latest.shp.zip</a> and
unzip it to a folder on your disk.</p>
<p>Data Source <a class="reference internal" href="credits.html#geofabrik" id="id1">[GEOFABRIK]</a></p>
</div>
<div class="section" id="procedure">
<h2>Procedmiento<a class="headerlink" href="#procedure" title="Enlazar permanentemente con este título">¶</a></h2>
<ol class="arabic simple">
<li>We will first run through the process of cleaning the shapefile manually to
note the commands that we will use in the python script. Launch QGIS and go
to <span class="menuselection">Layer ‣ Add Layer ‣ Add Vector Layer</span>.</li>
</ol>
<img alt="../_images/1129.png" class="align-center" src="../_images/1129.png" />
<ol class="arabic simple" start="2">
<li>Browse to the folder containing the unzipped shapefiles and select the
<code class="docutils literal"><span class="pre">roads.shp</span></code> file and click <span class="guilabel">Open</span>.</li>
</ol>
<img alt="../_images/270.png" class="align-center" src="../_images/270.png" />
<ol class="arabic simple" start="3">
<li>First we must re-project the roads layer to a Projected CRS. This will allow
us to use <em>meters</em> as units when performing analysis instead of degrees.
Open <span class="menuselection">Processing ‣ Toolbox</span>.</li>
</ol>
<img alt="../_images/339.png" class="align-center" src="../_images/339.png" />
<ol class="arabic simple" start="4">
<li>Search for the <span class="guilabel">Reproject layer</span> tool. Double-click it to launch
the dialog.</li>
</ol>
<img alt="../_images/429.png" class="align-center" src="../_images/429.png" />
<ol class="arabic simple" start="5">
<li>In the <span class="guilabel">Reproject layer</span> dialog, select the <code class="docutils literal"><span class="pre">roads</span></code> layer as
<span class="guilabel">Input layer</span>. We will use <code class="docutils literal"><span class="pre">EPSG:3460</span> <span class="pre">Fiji</span> <span class="pre">1986</span> <span class="pre">/</span> <span class="pre">Fiji</span> <span class="pre">Map</span> <span class="pre">Grid</span></code>
CRS as the <span class="guilabel">Target CRS</span>. Click <span class="guilabel">Run</span>.</li>
</ol>
<img alt="../_images/530.png" class="align-center" src="../_images/530.png" />
<ol class="arabic simple" start="6">
<li>Once the process finishes, you will see the reprojected layer loaded in
QGIS. Go to <span class="menuselection">Processing ‣ History and Log..</span>.</li>
</ol>
<img alt="../_images/628.png" class="align-center" src="../_images/628.png" />
<ol class="arabic simple" start="7">
<li>In the <span class="guilabel">History and Log</span> dialog, expand the <span class="guilabel">Algorithm</span>
folder and select the latest entry. You will see the full processing command
shown in the bottom panel. Note this command for use in our script.</li>
</ol>
<img alt="../_images/727.png" class="align-center" src="../_images/727.png" />
<ol class="arabic simple" start="8">
<li>Back in the main QGIS Window, click at the <span class="guilabel">CRS</span> button in the
bottom-right corner.</li>
</ol>
<img alt="../_images/826.png" class="align-center" src="../_images/826.png" />
<ol class="arabic simple" start="9">
<li>In the <span class="guilabel">Project Properties | CRS</span> dialog, check the
<span class="guilabel">Enable on-the-fly CRS transformation</span> and select <code class="docutils literal"><span class="pre">EPSG:3460</span> <span class="pre">Fiji</span>
<span class="pre">1986</span> <span class="pre">/</span> <span class="pre">Fiji</span> <span class="pre">Map</span> <span class="pre">Grid</span></code> as the CRS. This will ensure that our original and
reprojected layers will line up correctly.</li>
</ol>
<img alt="../_images/924.png" class="align-center" src="../_images/924.png" />
<ol class="arabic simple" start="10">
<li>Now we will run the cleaning operation. GRASS has a very powerful set of
topological cleaning tools. These are available in QGIS via the <code class="docutils literal"><span class="pre">v.clean</span></code>
algorithm. Search for this algorithm in the <span class="guilabel">Processing Toolbox</span>
and double-click it to launch the dialog.</li>
</ol>
<img alt="../_images/1025.png" class="align-center" src="../_images/1025.png" />
<ol class="arabic simple" start="11">
<li>You can read more about various tools and options in the <span class="guilabel">Help</span>
tab. For this tutorial, we will be using the <code class="docutils literal"><span class="pre">snap</span></code> tool to remove
duplicate vertices that are within 1 meter of each other. Select
<code class="docutils literal"><span class="pre">Reprojected</span> <span class="pre">layer</span></code> as the <span class="guilabel">Layer to clean</span>. Choose <code class="docutils literal"><span class="pre">snap</span></code> as
the <span class="guilabel">Cleaning tool</span>.  Enter <code class="docutils literal"><span class="pre">1.00</span></code> as the
<span class="guilabel">Threshold</span>. Leave the other fields blank and click
<span class="guilabel">Run</span>.</li>
</ol>
<img alt="../_images/1130.png" class="align-center" src="../_images/1130.png" />
<ol class="arabic simple" start="12">
<li>Once the processing finishes, you will see 2 new layers added to QGIS. The
<code class="docutils literal"><span class="pre">Cleaned</span> <span class="pre">vector</span> <span class="pre">layer</span></code> is the layer with topological errors corrected.
You will also have a <code class="docutils literal"><span class="pre">Errors</span> <span class="pre">layer</span></code> which will highlight the features
which were repaired. You can use the errors layer as a guide and zoom in to
see vertices that were removed.</li>
</ol>
<img alt="../_images/1226.png" class="align-center" src="../_images/1226.png" />
<ol class="arabic simple" start="13">
<li>Go to <span class="menuselection">Processing ‣ History and Log</span> dialog and note the
full processing command for later use.</li>
</ol>
<img alt="../_images/1323.png" class="align-center" src="../_images/1323.png" />
<ol class="arabic simple" start="14">
<li>We are ready to start coding now. See the <strong>A Text Editor or a Python IDE</strong>
section in the <a class="reference internal" href="building_a_python_plugin.html"><em>Construir una extension Python</em></a> tutorial for instructions to
setup your text editor or IDE. For running standalone python scripts that
use QGIS, we must set various configuration options. A good way to run
standalone scripts is to launch them via a <code class="docutils literal"><span class="pre">.bat</span></code> file. This file will
first set the correct configuration options and then call the python
script. Create a new file named <code class="docutils literal"><span class="pre">launch.bat</span></code> and enter the following
text. Change the values according to your QGIS configuration. Don&#8217;t forget
to replace the username with your own username in the path to the python
script.  The paths in this file will be the same on your system if you
installed QGIS via the <code class="docutils literal"><span class="pre">OSGeo4W</span> <span class="pre">Installer</span></code>. Save the file on your
Desktop.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Linux and Mac users will need to create a shell script to set the paths
and environment variables.</p>
</div>
<div class="highlight-none"><div class="highlight"><pre>REM Change OSGEO4W_ROOT to point to the base install folder
SET OSGEO4W_ROOT=C:\OSGeo4W64
SET QGISNAME=qgis
SET QGIS=%OSGEO4W_ROOT%\apps\%QGISNAME%
set QGIS_PREFIX_PATH=%QGIS%
REM Gdal Setup
set GDAL_DATA=%OSGEO4W_ROOT%\share\gdal\
REM Python Setup
set PATH=%OSGEO4W_ROOT%\bin;%QGIS%\bin;%PATH%
SET PYTHONHOME=%OSGEO4W_ROOT%\apps\Python27
set PYTHONPATH=%QGIS%\python;%PYTHONPATH%

REM Launch python job
python c:\Users\Ujaval\Desktop\download_and_clean.py
pause
</pre></div>
</div>
<img alt="../_images/1422.png" class="align-center" src="../_images/1422.png" />
<ol class="arabic simple" start="15">
<li>Create a new python file and enter the following code. Name the file as
<code class="docutils literal"><span class="pre">download_and_clean.py</span></code> and save it on your Desktop.</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="o">*</span>
<span class="k">print</span> <span class="s">&#39;Hello QGIS!&#39;</span>
</pre></div>
</div>
<img alt="../_images/1521.png" class="align-center" src="../_images/1521.png" />
<ol class="arabic simple" start="16">
<li>Switch to your Desktop and locate the <code class="docutils literal"><span class="pre">launch.bat</span></code> icon. Double-click it
to launch a new command window and run the script. If you see <code class="docutils literal"><span class="pre">Hello</span>
<span class="pre">QGIS!</span></code> printed in the command window, your configuration and setup worked
fine. If you see errors or do not see the text, check your <code class="docutils literal"><span class="pre">launch.bat</span></code>
file and make sure all the paths match the locations on your system.</li>
</ol>
<img alt="../_images/1620.png" class="align-center" src="../_images/1620.png" />
<ol class="arabic simple" start="17">
<li>Back in your text editor, modify the <code class="docutils literal"><span class="pre">download_and_clean.py</span></code> script to
add the following code. This is the bootstrap code to initialize QGIS.
These are unnecessary if you are running the script within QGIS. But since
we are running it outside QGIS, we need to add these at the beginning. Make
sure you replace the username with your username. After making these
changes, save the file and run <code class="docutils literal"><span class="pre">launch.bat</span></code> again. If you see <code class="docutils literal"><span class="pre">Hello</span>
<span class="pre">QGIS!</span></code> printed, you are all set to do add the processing logic to the
script.</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c"># Initialize QGIS Application</span>
<span class="n">QgsApplication</span><span class="o">.</span><span class="n">setPrefixPath</span><span class="p">(</span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">OSGeo4W64</span><span class="se">\\</span><span class="s">apps</span><span class="se">\\</span><span class="s">qgis&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">QgsApplication</span><span class="p">([],</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">QgsApplication</span><span class="o">.</span><span class="n">initQgis</span><span class="p">()</span>

<span class="c"># Add the path to Processing framework</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;c:</span><span class="se">\\</span><span class="s">Users</span><span class="se">\\</span><span class="s">Ujaval</span><span class="se">\\</span><span class="s">.qgis2</span><span class="se">\\</span><span class="s">python</span><span class="se">\\</span><span class="s">plugins&#39;</span><span class="p">)</span>

<span class="c"># Import and initialize Processing framework</span>
<span class="kn">from</span> <span class="nn">processing.core.Processing</span> <span class="kn">import</span> <span class="n">Processing</span>
<span class="n">Processing</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">processing</span>

<span class="k">print</span> <span class="s">&#39;Hello QGIS!&#39;</span>
</pre></div>
</div>
<img alt="../_images/1719.png" class="align-center" src="../_images/1719.png" />
<ol class="arabic simple" start="18">
<li>Recall the first processing command that we had saved from the log. This
was the command to re-project a layer. Paste the command to your script and
add the surrounding code as follows. Note that processing commands return
the path to the output layers as a dictionary. We are storing this as the
<code class="docutils literal"><span class="pre">ret</span></code> value and printing the path to the reprojected layer.</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre><span class="n">roads_shp_path</span> <span class="o">=</span> <span class="s">&quot;C:</span><span class="se">\\</span><span class="s">Users</span><span class="se">\\</span><span class="s">Ujaval</span><span class="se">\\</span><span class="s">Downloads</span><span class="se">\\</span><span class="s">fiji-latest.shp</span><span class="se">\\</span><span class="s">roads.shp&quot;</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">runalg</span><span class="p">(</span><span class="s">&#39;qgis:reprojectlayer&#39;</span><span class="p">,</span> <span class="n">roads_shp_path</span><span class="p">,</span> <span class="s">&#39;EPSG:3460&#39;</span><span class="p">,</span>
<span class="bp">None</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="s">&#39;OUTPUT&#39;</span><span class="p">]</span>
<span class="k">print</span> <span class="n">output</span>
</pre></div>
</div>
<img alt="../_images/1819.png" class="align-center" src="../_images/1819.png" />
<ol class="arabic simple" start="19">
<li>Run the script via <code class="docutils literal"><span class="pre">launch.bat</span></code> and you will see the path to the newly
created reprojected layer.</li>
</ol>
<img alt="../_images/1917.png" class="align-center" src="../_images/1917.png" />
<ol class="arabic simple" start="20">
<li>Now add the code for cleaning the topology. Since this is our final output,
we will add the output file paths as the last 2 arguments for the
<code class="docutils literal"><span class="pre">grass.v.clean</span></code> algorithm. If you left these blank, the output will be
created in a temporary directory.</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre><span class="n">processing</span><span class="o">.</span><span class="n">runalg</span><span class="p">(</span><span class="s">&quot;grass:v.clean&quot;</span><span class="p">,</span>
                  <span class="n">output</span><span class="p">,</span>
                  <span class="mi">1</span><span class="p">,</span>
                  <span class="mi">1</span><span class="p">,</span>
                  <span class="bp">None</span><span class="p">,</span>
                  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                  <span class="mf">0.0001</span><span class="p">,</span>
                  <span class="s">&#39;C:</span><span class="se">\\</span><span class="s">Users</span><span class="se">\\</span><span class="s">Ujaval</span><span class="se">\\</span><span class="s">Desktop</span><span class="se">\\</span><span class="s">clean.shp&#39;</span><span class="p">,</span>
                  <span class="s">&#39;C:\Users</span><span class="se">\\</span><span class="s">Ujaval</span><span class="se">\\</span><span class="s">Desktop</span><span class="se">\\</span><span class="s">errors.shp&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/2014.png" class="align-center" src="../_images/2014.png" />
<ol class="arabic simple" start="21">
<li>Run the script and you will see 2 new shapefiles created on your Desktop.
This completes the processing part of the script. Let&#8217;s add the code to
download the data from the original website and unzip it automatically. We
will also store the path to the unzipped file in a variable that we can
pass to the processing algorithm later. We will need to import some
additional modules for doing this. (See the end of the tutorial for the
full script with all the changes)</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">tempfile</span>

<span class="n">temp_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
<span class="n">download_url</span> <span class="o">=</span> <span class="s">&#39;http://download.geofabrik.de/australia-oceania/fiji-latest.shp.zip&#39;</span>
<span class="k">print</span> <span class="s">&#39;Downloading file&#39;</span>
<span class="nb">zip</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">download_url</span><span class="p">)</span>
<span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="nb">zip</span><span class="p">)</span> <span class="k">as</span> <span class="n">zf</span><span class="p">:</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">zf</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="k">if</span> <span class="s">&#39;roads&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">zf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s">&#39;roads.shp&#39;</span><span class="p">:</span>
                <span class="n">roads_shp_path</span> <span class="o">=</span> <span class="n">file_path</span>
</pre></div>
</div>
<img alt="../_images/2118.png" class="align-center" src="../_images/2118.png" />
<ol class="arabic simple" start="22">
<li>Run the completed script. Everytime you run the script, a fresh copy of the
data will be downloaded and processed.</li>
</ol>
<img alt="../_images/2217.png" class="align-center" src="../_images/2217.png" />
<ol class="arabic simple" start="23">
<li>To automate running on this script on a daily basis, we can use the <code class="docutils literal"><span class="pre">Task</span>
<span class="pre">Scheduler</span></code> in Windows. Launch the Task Scheduler and click
<span class="guilabel">Create Basic Task</span>.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Linux and Mac users can use cron jobs to schedule  tasks.</p>
</div>
<img alt="../_images/2314.png" class="align-center" src="../_images/2314.png" />
<ol class="arabic simple" start="24">
<li>Name the task as <code class="docutils literal"><span class="pre">Daily</span> <span class="pre">Download</span> <span class="pre">and</span> <span class="pre">Cleanup</span></code> and click <span class="guilabel">Next</span>.</li>
</ol>
<img alt="../_images/2412.png" class="align-center" src="../_images/2412.png" />
<ol class="arabic simple" start="25">
<li>Select <code class="docutils literal"><span class="pre">Daily</span></code> as the <span class="guilabel">Trigger</span> and click <span class="guilabel">Next</span></li>
</ol>
<img alt="../_images/2511.png" class="align-center" src="../_images/2511.png" />
<ol class="arabic simple" start="26">
<li>Select a time as per your liking and click <span class="guilabel">Next</span>.</li>
</ol>
<img alt="../_images/2610.png" class="align-center" src="../_images/2610.png" />
<ol class="arabic simple" start="27">
<li>Choose <code class="docutils literal"><span class="pre">Start</span> <span class="pre">a</span> <span class="pre">program</span></code> as the <span class="guilabel">Action</span> and click
<span class="guilabel">Next</span>.</li>
</ol>
<img alt="../_images/278.png" class="align-center" src="../_images/278.png" />
<ol class="arabic simple" start="28">
<li>Click <span class="guilabel">Browse</span> and locate the <code class="docutils literal"><span class="pre">launch.bat</span></code> script. Click
<span class="guilabel">Next</span>.</li>
</ol>
<img alt="../_images/286.png" class="align-center" src="../_images/286.png" />
<ol class="arabic simple" start="29">
<li>Click <span class="guilabel">Finish</span> at the last screen to schedule the task. Now the
script will automatically launch at the specified time to give you a fresh
copy of cleaned data everyday.</li>
</ol>
<img alt="../_images/295.png" class="align-center" src="../_images/295.png" />
<p>Below is the full <code class="docutils literal"><span class="pre">download_and_clean.py</span></code> script for your reference.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">tempfile</span>

<span class="c"># Initialize QGIS Application</span>
<span class="n">QgsApplication</span><span class="o">.</span><span class="n">setPrefixPath</span><span class="p">(</span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">OSGeo4W64</span><span class="se">\\</span><span class="s">apps</span><span class="se">\\</span><span class="s">qgis&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">QgsApplication</span><span class="p">([],</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">QgsApplication</span><span class="o">.</span><span class="n">initQgis</span><span class="p">()</span>

<span class="c"># Add the path to Processing framework  </span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;c:</span><span class="se">\\</span><span class="s">Users</span><span class="se">\\</span><span class="s">Ujaval</span><span class="se">\\</span><span class="s">.qgis2</span><span class="se">\\</span><span class="s">python</span><span class="se">\\</span><span class="s">plugins&#39;</span><span class="p">)</span>

<span class="c"># Import and initialize Processing framework</span>
<span class="kn">from</span> <span class="nn">processing.core.Processing</span> <span class="kn">import</span> <span class="n">Processing</span>
<span class="n">Processing</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">processing</span>

<span class="c"># Download and unzip the latest shapefile</span>
<span class="n">temp_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
<span class="n">download_url</span> <span class="o">=</span> <span class="s">&#39;http://download.geofabrik.de/australia-oceania/fiji-latest.shp.zip&#39;</span>
<span class="k">print</span> <span class="s">&#39;Downloading file&#39;</span>
<span class="nb">zip</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">download_url</span><span class="p">)</span>
<span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="nb">zip</span><span class="p">)</span> <span class="k">as</span> <span class="n">zf</span><span class="p">:</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">zf</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="k">if</span> <span class="s">&#39;roads&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">zf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s">&#39;roads.shp&#39;</span><span class="p">:</span>
                <span class="n">roads_shp_path</span> <span class="o">=</span> <span class="n">file_path</span>

<span class="k">print</span> <span class="s">&#39;Downloaded file to </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">roads_shp_path</span>

<span class="c"># Reproject the Roads layer</span>
<span class="k">print</span> <span class="s">&#39;Reprojecting the roads layer&#39;</span>

<span class="n">ret</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">runalg</span><span class="p">(</span><span class="s">&#39;qgis:reprojectlayer&#39;</span><span class="p">,</span> <span class="n">roads_shp_path</span><span class="p">,</span> <span class="s">&#39;EPSG:3460&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="s">&#39;OUTPUT&#39;</span><span class="p">]</span>

<span class="c"># Clean the Roads layer</span>
<span class="k">print</span> <span class="s">&#39;Cleaning the roads layer&#39;</span>

<span class="n">processing</span><span class="o">.</span><span class="n">runalg</span><span class="p">(</span><span class="s">&quot;grass:v.clean&quot;</span><span class="p">,</span>
                  <span class="n">output</span><span class="p">,</span>
                  <span class="mi">1</span><span class="p">,</span>
                  <span class="mi">1</span><span class="p">,</span>
                  <span class="bp">None</span><span class="p">,</span>
                  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                  <span class="mf">0.0001</span><span class="p">,</span>
                  <span class="s">&#39;C:</span><span class="se">\\</span><span class="s">Users</span><span class="se">\\</span><span class="s">Ujaval</span><span class="se">\\</span><span class="s">Desktop</span><span class="se">\\</span><span class="s">clean.shp&#39;</span><span class="p">,</span>
                  <span class="s">&#39;C:\Users</span><span class="se">\\</span><span class="s">Ujaval</span><span class="se">\\</span><span class="s">Desktop</span><span class="se">\\</span><span class="s">errors.shp&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&#39;Success&#39;</span>
</pre></div>
</div>
</div>
</div>





  <div id="disqus_thread"></div>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


    </div>
      
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2016, Ujaval Gandhi.<br/>
      Actualizado por última vez en Apr 30, 2018.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.6.<br/>
    </p>
  </div>
</footer>
<div class="container">
  <p>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/deed.en_US">Creative Commons Attribution 4.0 International License</a></p>
</div>
<!-- Twitter Button -->
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<!-- Disqus comments widget -->
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'qgistutorials'; // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script>

<script type="text/javascript">
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=spatialthoughts" async="async"></script>

<!-- Script fpr language switching. Largely adapted from https://github.com/pcav/faunalia-website -->
<script>
    var currentPage = 'docs/running_qgis_jobs.html'; // coming from sphinx, always without starting '/'
    var currentLang = 'en';
    $(document).ready(function(){

        var search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
        var langPlusPage = window.location.href.match(search);
        // it's possible this is a index.html page called without 'index.html', try without the currentPage
        if (langPlusPage==undefined){
            search = new RegExp('\/[a-zA-Z_]{2,8}\/$', 'gi');
            langPlusPage = window.location.href.match(search);
        }

        // it's possible this is an index.html page called without 'index.html', try removing index.html
        if (langPlusPage==undefined){
            currentPage = currentPage.replace('index.html','')
            search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
            langPlusPage = window.location.href.match(search);
        }
        // still no langPlugPage: stop, because the language swicher will misbehave 

        if (langPlusPage == undefined || langPlusPage.length != 1){
            alert('You hit an error, please report back to us.');
            return;
        }
        langPlusPage = langPlusPage[0];
        currentLang = langPlusPage.replace(currentPage, '');

        $("#languages").val(currentLang.replace(/\//g,'')); // currentLang is something like '/nl/'

        $("#languages").change(function() {
            gotoLang($(this).val());
        });

    });

    // load current page in a different language
    function gotoLang(lang){
        var currentUrl = window.location.href;
        var newUrl = currentUrl.replace(currentLang, '/'+lang+'/');
        window.location.href = newUrl;
    }
</script>

  </body>
</html>